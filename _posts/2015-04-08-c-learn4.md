---
layout: post
title: c 函数学习下
categories: c
tags: 笔记 c
---

#### 静态变量

用 static 声明限定外部变量与函数，可以将其后声明的对象的作用域限定为被编译源文件的剩余部分。

外部的static 声明通常多用于变量，也可用于声明函数。

如果把函数声明为 static 类型，则该函数名除了对该函数声明所在的文件可见外，其它文件都无法访问。

static 也可用于声明内部变量。static类型的内部变量同自动变量一样，是某个特定函数的局部变量，只能在该函数中使用，但它与自动变量不同的是，不管其所在函数是否被调用，它一直存在，而不像自动变量那样，随着所在函数的被调用和退出而存在和消失。

#### 寄存器变量

register 声明告诉编译器，它所声明的变量在程序中使用频率较高。其思想是，将 register 变量放在机器的寄存器中，这样可以使程序更小、执行速度更快。

```c
register int x;
register char c;
```

register 声明只适用于自动变量以及函数的形式参数

#### 程序块结构

如下一段代码：

```c
if (n > 0) {
	int i; /* declare a new i */
		for (i = 0; i < n; i++)
				...
				}
				```

				变量 i 的作用域是 if 语句的“真”分支，这个 i 与该程序块外声明的 i 无关。

				#### 初始化

				在不进行显式初始化的情况下，外部变量和静态变量都将被初始化为0，而自动变量和寄存器变量的初值则没有定义（即初值为无用的信息）。

				如下进行初始化：

				```c
				int x = 1;
				char squota = '\'';
				long day = 1000L * 60L * 60L * 24L; /* milliseconds/day */
				```

				对于外部变量与静态变量来说，初始化表达式必须是常量表达式，且只初始化一次（从概念上讲是在程序开始执行前进行初始化）。对于自动变量与寄存器变量，则在每次进入函数或程序块时都将被初始化。

				#### C预处理器

				预处理器是编译过程中单独执行的第一个步骤。

				两个最常用的预处理器指令是：#include 指令（用于在编译期间把指定文件的内容包含进当前文件中）和 #define 指令（用任意字符序列替代一个标记）。

				`#include` 有两种形式：

				```c
				#include "文件名"
				#include <文件名>
				```

				如果文件名用引号引起来，则在源文件所在位置查找该文件；如果在该位置没有找到文件，或者如果文件名是用尖括号<与>括起来的，
				则将根据相应的规则查找该文件，这个规则同具体的实现有关。

				宏替换的定义如下:

				```c
				#define 名字  替换文本
				#define forever for (;;) /* infinite loop */
				```

				宏定义也可以带参数，这样可以对不同的宏调用使用不同的替换文本。

				```c
				#define max(A, B)  ((A) > (B) ? (A) : (B))
				```

				如果使用这个宏的话：

				```c
				= max(p+q, r+s);
				将被替换为下列形式：
				x = ((p+q) > (r+s) ? (p+q) : (r+s));
				```

				仔细考虑一下 max 的展开式，就会发现它存在一些缺陷。其中，作为参数的表达式要重复计算两次。

				```c
				max(i++, j++)
				```

				同时还必须注意，要适当使用圆括号以保证计算次序的正确性。

				```c
				#define square(x) x * x /* WRONG */
				squrare(z+1)调用该宏定义时会出现问题
				```

				可以通过 #undef指令取消名字的宏定义，这样做可以保证后续的调用是函数调用，而不是宏调用：

				```c
				#undef getchar
				int getchar(void) { ... }
				```

				形式参数不能用带引号的字符串替换。但是，如果在替换文本中，参数名以`#`作为前缀则结果将被扩展为由实际参数替换该参数的带引号的字符串。

				```c
				#define dprint(expr) printf(#expr " = %g\n", expr)
				使用语句
				dprint(x/y)
				调用该宏时，该宏将被扩展为：
				printf("x/y" " = &g\n", x/y);
				```

				在预处理的时候也可以使用条件语句：

				```c
				#if SYSTEM == SYSV
				#define HDR "sysv.h"
				#elif SYSTEM == BSD
				#define HDR "bsd.h"
				#elif SYSTEM == MSDOS
				#define HDR "msdos.h"
				#else
				#define HDR "default.h"
				#endif
				#include HDR
				```

				【参考资料】

				1. [C程序设计语言 ](http://book.douban.com/subject/1139336/)

				---EOF---
